<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Snake Fullscreen Pure</title>
    <style>
        body {
            background-color: #879c85; /* Nokia Green */
            margin: 0;
            overflow: hidden;
            touch-action: none; /* No scroll/zoom */
            font-family: 'Courier New', monospace;
            user-select: none;
            -webkit-user-select: none;
        }

        /* HUD in alto (Punteggio) */
        #hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            font-size: 18px;
            color: #000;
            z-index: 20;
            pointer-events: none; /* Lascia passare i click */
        }

        /* Pulsante Pausa Visibile (piccolo in alto) */
        #btn-pause-ui {
            pointer-events: auto;
            border: 2px solid #000;
            background: transparent;
            font-weight: bold;
            font-family: inherit;
            padding: 2px 8px;
        }

        /* Area di Gioco */
        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
            image-rendering: pixelated;
        }

        /* --- CONTROLLI INVISIBILI (Smart Touch Zones) --- */
        #controls-layer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 45%; /* Occupa quasi metà schermo in basso */
            z-index: 50;
            /* background: rgba(255,0,0,0.2); /* <--- SCOMMENTA PER VEDERE LE AREE (DEBUG) */
        }

        .touch-zone {
            position: absolute;
            /* border: 1px dashed white; /* DEBUG */
        }

        /* Disposizione a Croce (D-Pad Invisibile) */
        #zone-up {
            top: 0; left: 33.3%; width: 33.3%; height: 50%;
        }
        #zone-down {
            bottom: 0; left: 33.3%; width: 33.3%; height: 50%;
        }
        #zone-left {
            top: 25%; left: 0; width: 33.3%; height: 50%;
        }
        #zone-right {
            top: 25%; right: 0; width: 33.3%; height: 50%;
        }

        /* Feedback Tocco (Opzionale: leggero flash quando premi) */
        .touch-zone:active {
            background: rgba(0,0,0,0.1);
        }

        /* Overlay Messaggi (Game Over / Pausa) */
        #overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            display: none;
            z-index: 60;
            background: rgba(135, 156, 133, 0.9);
            padding: 20px;
            border: 4px solid #000;
        }
        h1 { margin: 0 0 10px 0; font-size: 30px; }
        p { font-size: 14px; font-weight: bold; margin-bottom: 20px; }
        .action-btn {
            background: #000; color: #879c85;
            border: none; padding: 10px 20px;
            font-size: 18px; font-family: inherit; font-weight: bold;
            cursor: pointer;
        }

    </style>
</head>
<body>

<div id="hud">
    <span>SCORE: <span id="score-val">0</span></span>
    <button id="btn-pause-ui" ontouchstart="togglePause()">II</button>
</div>

<canvas id="gc"></canvas>

<div id="controls-layer">
    <div id="zone-up" class="touch-zone" ontouchstart="input(0, -1, event)"></div>
    <div id="zone-down" class="touch-zone" ontouchstart="input(0, 1, event)"></div>
    <div id="zone-left" class="touch-zone" ontouchstart="input(-1, 0, event)"></div>
    <div id="zone-right" class="touch-zone" ontouchstart="input(1, 0, event)"></div>
</div>

<div id="overlay">
    <h1 id="overlay-title">PAUSED</h1>
    <p>BEST: <span id="best-val">0</span></p>
    <button class="action-btn" onclick="togglePause()">RESUME</button>
</div>

<script>
    const canvas = document.getElementById("gc");
    const ctx = canvas.getContext("2d");
    const scoreValEl = document.getElementById("score-val");
    const bestValEl = document.getElementById("best-val");
    const overlay = document.getElementById("overlay");
    const overlayTitle = document.getElementById("overlay-title");

    // Configurazione
    let gridSize = 20; // Pixel grandi
    let tileCountX, tileCountY;
    
    // Stato
    let px, py;
    let xv=0, yv=0;
    let trail = [];
    let tail = 5;
    let score = 0;
    let ax, ay;
    
    let isPaused = false;
    let isGameOver = false;
    let gameInterval;
    let lastInputTime = 0;

    // Load Best Score
    let highScore = localStorage.getItem('snake_pure_best') || 0;
    bestValEl.innerText = highScore;

    // --- INIT ---
    window.onload = () => {
        resize();
        window.addEventListener('resize', resize);
        document.addEventListener('keydown', handleKey);
        
        // Easter Egg Logic
        checkEasterEgg();

        // Start
        resetGame();
        gameInterval = setInterval(gameLoop, 1000/12); // 12 FPS (Retro feel)
    };

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        tileCountX = Math.floor(canvas.width / gridSize);
        tileCountY = Math.floor(canvas.height / gridSize);
    }

    function checkEasterEgg() {
        if(!localStorage.getItem('snake_pure_best')) {
            // Se è la prima volta assoluta, setta Easter Egg finto nella memoria (opzionale)
            // Ma qui salviamo solo il numero. Se vuoi la leaderboard complessa serve JSON.
            // Per ora salviamo il numero alto se richiesto.
            // localStorage.setItem('snake_pure_best', 999999); 
        }
    }

    function resetGame() {
        score = 0;
        tail = 5;
        trail = [];
        xv = 0; yv = 0;
        px = Math.floor(tileCountX / 2);
        py = Math.floor(tileCountY / 2);
        scoreValEl.innerText = 0;
        isGameOver = false;
        isPaused = false;
        overlay.style.display = "none";
        spawnApple();
    }

    function gameLoop() {
        if(isPaused || isGameOver) return;

        px += xv;
        py += yv;

        // --- WRAP LOGIC (Attraversa Muri) ---
        if(px < 0) px = tileCountX - 1;
        if(px > tileCountX - 1) px = 0;
        if(py < 0) py = tileCountY - 1;
        if(py > tileCountY - 1) py = 0;

        // Draw Background
        ctx.fillStyle = "#879c85";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw Snake
        ctx.fillStyle = "#000";
        for(let i=0; i<trail.length; i++) {
            ctx.fillRect(trail[i].x * gridSize, trail[i].y * gridSize, gridSize-2, gridSize-2);
            
            // Collisione Coda (Self-Hit)
            if(trail[i].x === px && trail[i].y === py) {
                // Game Over solo se ti mordi la coda e ti stai muovendo
                if(xv !== 0 || yv !== 0) {
                    gameOver();
                }
            }
        }

        trail.push({x: px, y: py});
        while(trail.length > tail) {
            trail.shift();
        }

        // Eat Apple
        if(ax === px && ay === py) {
            tail++;
            score++;
            scoreValEl.innerText = score;
            spawnApple();
        }

        // Draw Apple
        ctx.fillRect(ax*gridSize, ay*gridSize, gridSize-2, gridSize-2);
    }

    function spawnApple() {
        // Evita spawn sopra HUD (prima riga)
        let safeY = Math.floor(50 / gridSize); 
        ax = Math.floor(Math.random() * tileCountX);
        ay = Math.floor(Math.random() * (tileCountY - safeY)) + safeY;
    }

    function gameOver() {
        isGameOver = true;
        if(score > highScore) {
            highScore = score;
            localStorage.setItem('snake_pure_best', highScore);
            bestValEl.innerText = highScore;
        }
        overlayTitle.innerText = "GAME OVER";
        overlay.querySelector("button").innerText = "RESTART";
        overlay.style.display = "block";
    }

    function togglePause() {
        if(isGameOver) {
            resetGame();
            return;
        }
        isPaused = !isPaused;
        if(isPaused) {
            overlayTitle.innerText = "PAUSED";
            overlay.querySelector("button").innerText = "RESUME";
            overlay.style.display = "block";
        } else {
            overlay.style.display = "none";
        }
    }

    // --- INPUT HANDLING ---
    function input(x, y, e) {
        if(e) e.preventDefault(); // Stop zoom/scroll
        
        if(isPaused || isGameOver) return;

        let now = Date.now();
        if(now - lastInputTime < 50) return; // Debounce veloce
        lastInputTime = now;

        // Non permettere inversione a U
        if (x === -xv && x !== 0) return;
        if (y === -yv && y !== 0) return;
        
        // Se il gioco è fermo all'inizio, parti subito
        if(xv === 0 && yv === 0) {
             // First move
        }

        xv = x;
        yv = y;
    }

    function handleKey(evt) {
        switch(evt.keyCode) {
            case 37: input(-1, 0); break;
            case 38: input(0, -1); break;
            case 39: input(1, 0); break;
            case 40: input(0, 1); break;
            case 80: togglePause(); break; // P
        }
    }
</script>
</body>
</html>
